/*
 * game.h
 *
 *  Created on: 9 avr. 2020
 *      Author: marc
 */

#ifndef GAME_H_
#define GAME_H_

#include<stdio.h>
#include<pthread.h>
#include<semaphore.h>
#include<stdlib.h>
#include<string.h>
#include<unistd.h>
#include "game_p4.h"

#define TAB_SIZE 7
#define COLOR_P1 blue
#define COLOR_P2 green
#define BACKGROUND black
#define MAX_NUMBER 9
#define MIN_NUMBER 0
#define INIT_OK 1
#define MSG_SIZE 5
#define READ_BUTTON_BUFER_SIZE 5
#define TIMER_NB 1
// DEFINE DES TEMPS POUR TIMER (TIMER BOUCLE TOUTE LES 100 millisecondes)
#define LAUNCH_TIMER 50 // 5 secondes
#define ROUND_TIMER 300 // 30 secondes
#define IDLE_TIMER 50
#define BLINK_CANCEL_TIMER 50
#define BLINK_VICTORY_TIMER 50

typedef enum {
	STOP, ACTIVE, TIMEOUT
}timer_status;

typedef enum {
	NO_OWNER, APP, DISPLAY
}timer_owner;

typedef enum{
	ROUND, LAUNCH, IDLE, CANCEL, BLINK, UNAFFECTED
}timer_name;

typedef struct {
	timer_name name;
	timer_status status;
	timer_owner owner;
	int countdown;
}timer;

typedef struct {
	timer timer;
	pthread_mutex_t mutex;
}timer_list;

typedef enum {
	PAD_1 = 49, PAD_2 = 50, DOWN = 100, LEFT = 108, RIGHT = 114, UP = 117, PRESSED = 100,
} pad_command;

typedef struct{
	timer_name name;
	timer_status status;
}timer_msg;

typedef struct {
	pad_command pad;
	pad_command command;
	move_token token;
	timer_msg timer;
} data_msg;

typedef struct User_input user_input;
struct User_input {
	void *data;
	size_t size_of_data;
	user_input *next;
};

typedef struct Queue queue;
struct Queue {
	user_input *first;
	user_input *last;
	pthread_mutex_t mutex;
	sem_t semaphore;
};

typedef struct {
	color board[TAB_SIZE][TAB_SIZE];
	int init;
} Matrix;

typedef enum {
	QUEUE_READ, QUEUE_SEND
} QUEUE_ID;

sem_t sem_button;
sem_t sem_display;
queue *queue_push_app;
queue *queue_app_display;

/* THREAD */
void *user_button(void *arg);
void *show_board(void *arg);
void *application(void *arg);
void *timers(void *arg);

/* FONCTIONS */
void set_number(int nbr);
void init_matrix(void);
queue *queue_init(void);
void push(queue *queue, void *input, size_t data_size);
int pop_element(queue *queue, void *value, size_t data_size);

#endif /* GAME_H_ */
